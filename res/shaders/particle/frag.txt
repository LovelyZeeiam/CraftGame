#version 330

in vec2 otexPos;
in vec4 ocolor;
in vec2 otex;
in vec4 FragPosLightSpace;

uniform sampler2D texSampler;

out vec4 out_color;

uniform sampler2D depthMap;

float shadowCalculation() {
	vec3 projCoords = FragPosLightSpace.xyz / FragPosLightSpace.w;
	projCoords = projCoords * 0.5 + 0.5;
	
	float closestDepth = texture(depthMap, projCoords.xy).r;
	float currentDepth = projCoords.z;
	
	float shadow = currentDepth > closestDepth ? 1.0 : 0.0;
	return shadow * 0.6 + 0.4;
}

void main(){
	float shadow = shadowCalculation();
	if(otex.x != 114514)
		out_color = texture(texSampler, otex) * ocolor;
	else
		out_color = texture(texSampler, gl_PointCoord) * ocolor;
	
}