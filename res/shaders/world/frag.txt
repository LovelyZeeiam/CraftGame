#version 330

const vec3 sunColor = vec3(1.0, 1.0, 1.0);

in vec3 fragPos;
in vec2 otexPos;
in vec3 ocolor;
in float osunLight;
in float visibility;
in vec3 onormal;

uniform vec3 skyColor;
uniform vec3 sunDirection;
uniform sampler2D texSampler;

out vec4 out_color;

float diff() {
	vec3 norm = normalize(onormal);
	vec3 lightDir = normalize(sunDirection);
	return -max(dot(norm, lightDir), 0.0);
}

void main(){
	vec3 sunLightColor = sunColor * osunLight;
	vec3 real_sun_color = mix(ocolor, sunLightColor, 1.0);
	
	vec4 ambient = texture(texSampler, otexPos);
	if(ambient.w == 0) discard;
	
	vec3 color = ambient.xyz * vec3(mix(0.8,2.0,diff()));
	
	out_color = mix(vec4(skyColor, 1.0), vec4(color, ambient.w), visibility);

	
}